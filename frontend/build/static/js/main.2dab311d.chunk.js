(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{200:function(e,t,n){"use strict";n.r(t);var a=n(44),c=n.n(a),r=n(4),s=n(242),i=n(252),o=n(0),l=n.n(o),j=n(55),u=n(19),d=n(136),b=n(22),h=n.n(b),m=n(42),O=n(34),p=n.n(O),x=n(90),f=n(128),g=n(254),v=n(253),w=n(259),S=n(256),y=n(260),k=n(261),C=n(262),I=n(263),T=n(249),M=n(257),U=n(1),W=function(e){return Object(U.jsxs)(v.a,{component:"main",alignItems:"center",children:[Object(U.jsx)(s.a,{}),Object(U.jsx)(w.a,{component:S.a,children:Object(U.jsx)(y.a,{sx:{minWidth:300},children:Object(U.jsxs)(k.a,{children:[Object(U.jsx)(C.a,{children:Object(U.jsx)(I.a,{children:Object(U.jsx)(T.a,{variant:"contained",disabled:e.mySide===e.turn,color:e.mySide===e.turn?"primary":"success",sx:{fontSize:35},children:e.opponentTimeInfo})})}),Object(U.jsx)(C.a,{children:Object(U.jsx)(I.a,{children:Object(U.jsx)(M.a,{variant:"h5",children:e.opponentUsername})})}),Object(U.jsx)(C.a,{children:Object(U.jsx)(I.a,{children:Object(U.jsx)("div",{style:{overflow:"auto"},children:Object(U.jsx)("div",{style:{height:"150px",width:"300"},children:Object(U.jsx)(y.a,{sx:{tableLayout:"fixed",maxWidth:300},children:Object(U.jsx)(k.a,{children:e.pgnMoves.map((function(e,t){return Object(U.jsxs)(C.a,{sx:{height:5},children:[Object(U.jsx)(I.a,{children:t+1}),Object(U.jsx)(I.a,{children:e.whiteMove}),Object(U.jsx)(I.a,{children:e.blackMove})]})}))})})})})})}),Object(U.jsx)(C.a,{children:Object(U.jsx)(I.a,{children:Object(U.jsx)(M.a,{variant:"h5",children:e.myUsername})})}),Object(U.jsx)(C.a,{children:Object(U.jsx)(I.a,{children:Object(U.jsx)(T.a,{sx:{fontSize:35},disabled:e.mySide!==e.turn,color:e.mySide===e.turn?"success":"primary",variant:"contained",children:e.myTimeInfo})})})]})})})]})};function D(e,t){var n=e.initialMinute,a=void 0===n?5:n,c=e.initialSeconds,s=void 0===c?0:c,i=Object(o.useState)(a),l=Object(r.a)(i,2),j=l[0],u=l[1],d=Object(o.useState)(s),b=Object(r.a)(d,2),h=b[0],m=b[1],O=Object(o.useState)(e.isTicking),p=Object(r.a)(O,2),x=p[0],f=p[1];function g(){return j}function v(){return h}function w(){f(0)}function S(){f(1)}return Object(o.useImperativeHandle)(t,(function(){return{getMinutes:g,getSeconds:v,stopTimer:w,startTimer:S}})),Object(o.useEffect)((function(){var e=500;return x&&(e=setInterval((function(){h>0&&m(h-1),0===h&&(0===j?clearInterval(e):(u(j-1),m(59)))}),500)),function(){clearInterval(e)}})),Object(U.jsx)(U.Fragment,{})}var R=Object(o.forwardRef)(D),L=n(101),N=n.p+"static/media/Move.8d802efe.mp3",E=(n.p,n.p+"static/media/Checkmate.39de2c5a.mp3");var P=function(e){for(var t=[],n=e.split(" "),a=0;a<n.length;a+=3)a+2<n.length?t[a/3]={whiteMove:n[a+1],blackMove:n[a+2]}:t[a/3]={whiteMove:n[a+1],blackMove:""};return t};var q=function(){var e=Object(o.useContext)(ie),t=e.socket,n=e.userMap,a="function"===typeof x?x:x.Chess,c=Object(o.useState)(new a),s=Object(r.a)(c,2),i=s[0],l=(s[1],Object(o.useState)(i.fen())),j=Object(r.a)(l,2),d=j[0],b=j[1],O=Object(o.useState)("white"),v=Object(r.a)(O,2),w=v[0],S=v[1],y=Object(o.useState)("05:00"),k=Object(r.a)(y,2),C=k[0],I=k[1],T=Object(o.useState)("05:00"),M=Object(r.a)(T,2),D=M[0],q=M[1],F=Object(o.useState)(n.get(t.id).name),_=Object(r.a)(F,1)[0],z=Object(o.useState)([]),A=Object(r.a)(z,2),B=A[0],G=A[1],V=Object(u.g)(),J=V.id,Y=V.mycolor,H=Object(o.useState)(n.get(J).name),K=Object(r.a)(H,1)[0],Q=Object(o.useRef)(),X=Object(o.useRef)(),Z=Object(L.a)(N),$=Object(r.a)(Z,1)[0],ee=Object(L.a)(E),te=(Object(r.a)(ee,1)[0],function(){var e=Object(m.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.a.post("".concat("http://localhost:5000","/api/games"),{whiteUsername:"dummywhite",blackUsername:"dummyblack",winnerUsername:"dummywinner",loserUsername:"dummyloser",pgn:i.pgn()});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}());return Object(o.useEffect)((function(){function e(e){var t=e.toString();return e<10&&(t="0"+t),t}1==Y&&S("black"),t.on("send_move",(function(e){if(console.log(e.move),i.move(e.move),b(i.fen()),Q.current.stopTimer(),X.current.startTimer(),G(P(i.pgn())),$(),i.isGameOver()){var n="";if(i.isCheckmate())if(i.inCheck()&&i.turn()===w)n+=i.turn()+" lost";else n+=("w"===i.turn()?"b":"w")+" lost";else i.isDraw()&&(n+="game drawn",i.isInsufficientMaterial()||i.isStalemate()||i.isThreefoldRepetition(),t.emit("game_over",{to:J,gameResult:n}));console.log("game over"),te()}})),t.on("game_over",(function(e){console.log("Game over!",e)}));var n=setInterval((function(){var t=e(Q.current.getMinutes())+":"+e(Q.current.getSeconds());I(t);var n=e(X.current.getMinutes())+":"+e(X.current.getSeconds());q(n)}),500);return function(){t.off("send_move"),clearInterval(n)}}),[]),Object(U.jsxs)(g.a,{container:!0,sx:{mt:5},direction:"row",alignItems:"center",justifyContent:"center",spacing:3,children:[Object(U.jsx)(g.a,{item:!0,children:Object(U.jsx)(f.a,{id:"BasicBoard",showBoardNotation:"true",position:d,onPieceDrop:function(e,n){if(i.turn()===w[0]){var a={from:e,to:n},c=i.move(a);if(null!=c||(a={from:e,to:n,promotion:"q"},null!=(c=i.move(a)))){if($(),i.isGameOver()){var r="";if(i.isCheckmate())if(i.inCheck()&&i.turn()===w)r+=i.turn()+" lost";else r+=("w"===i.turn()?"b":"w")+" lost";else i.isDraw()&&(r+="game drawn",i.isInsufficientMaterial()||i.isStalemate()||i.isThreefoldRepetition());t.emit("game_over",{to:J,gameResult:r}),console.log("game over")}Q.current.startTimer(),X.current.stopTimer(),G(P(i.pgn())),console.log(P(i.pgn())),b(i.fen()),function(e){console.log("Sending Move",e),t.emit("send_move",{to:J,move:e})}(a)}else console.log("Invalid move")}else console.log("Not your turn!")},boardOrientation:w,arePremovesAllowed:"true",clearPremovesOnRightClick:"true",onSquareClick:function(e){console.log(e)},boardWidth:"720"})}),Object(U.jsx)(g.a,{item:!0,children:Object(U.jsx)(W,{opponentUsername:K,myUsername:_,opponentTimeInfo:C,myTimeInfo:D,pgnMoves:B,mySide:w[0],turn:i.turn()})}),Object(U.jsx)(R,{initialMinute:5,initialSeconds:0,isTicking:0,ref:X}),Object(U.jsx)(R,{initialMinute:5,initialSeconds:0,isTicking:0,ref:Q})]})},F=n(103),_=n(258),z=n(245),A=function(e){var t=Object(o.useContext)(ie),n=t.initSocket,a=t.socket,c=t.updateUserList,s=t.userList,i=t.userId,l=e.name,j=Object(u.f)(),d=Object(o.useState)({}),b=Object(r.a)(d,2),h=b[0],m=b[1],O=Object(o.useState)(0),p=Object(r.a)(O,2),x=p[0];p[1];Object(o.useEffect)((function(){return a.on("Challenge",(function(e){j.push("/play/"+e.from+"/"+e.yourcolor),console.log("Got Challange")})),function(){a.off("Challenge")}}),[]);return Object(U.jsxs)(_.a,{component:"form",noValidate:!0,onSubmit:function(e){console.log("Sending challenge"),e.preventDefault(),a.emit("Challenge",{to:h.id,msg:"challenge",yourcolor:1==x?0:1}),j.push("/play/"+h.id+"/"+x)},sx:{mt:3},children:[Object(U.jsxs)(z.a,{name:"Receiver",onChange:function(e){e.preventDefault();var t=e.target.options.selectedIndex,n=e.target.options[t].getAttribute("id");m({id:n,name:e.target.value})},onMouseOver:function(){n({name:l,userId:i}),c()},children:[Object(U.jsx)("option",{value:"Select Receiver",children:"Select Receiver"}),s&&s.map((function(e){return e.name===l?"":Object(U.jsx)("option",{id:e.id,value:e.name,children:e.name+"--"+e.userId},e.id)}))]}),Object(U.jsx)(T.a,{type:"submit",children:"Challenge"})]})},B=n(264),G=function(){var e=Object(o.useContext)(ie),t=e.userId,n=e.setUserId,a=Object(o.useState)(""),c=Object(r.a)(a,2),i=c[0],l=c[1],j=Object(o.useState)(""),d=Object(r.a)(j,2),b=d[0],O=d[1],x=Object(o.useState)(""),f=Object(r.a)(x,2),g=f[0],W=f[1],D=Object(o.useState)([]),R=Object(r.a)(D,2),L=R[0],N=R[1],E=Object(u.f)(),P=Object(o.useContext)(ie),q=P.initSocket,_=P.updateUserList;Object(o.useEffect)((function(){z(),V();var e=setInterval((function(){_()}),2e3);return function(){clearInterval(e)}}),[]),Object(o.useEffect)((function(){q({name:i,userId:t}),_()}),[t,i]);var z=function(){var e=Object(m.a)(h.a.mark((function e(){var t,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.a.get("".concat("http://localhost:5000","/api/token"));case 3:t=e.sent,O(t.data.accessToken),a=Object(F.a)(t.data.accessToken),l(a.name),n(a.id),W(a.exp),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.response&&E.push("/");case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),G=p.a.create();G.interceptors.request.use(function(){var e=Object(m.a)(h.a.mark((function e(t){var n,a,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Date,!(1e3*g<n.getTime())){e.next=10;break}return e.next=4,p.a.get("".concat("http://localhost:5000","/api/token"));case 4:a=e.sent,t.headers.Authorization="Bearer ".concat(a.data.accessToken),O(a.data.accessToken),c=Object(F.a)(a.data.accessToken),l(c.name),W(c.exp);case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return Promise.reject(e)}));var V=function(){var e=Object(m.a)(h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.get("".concat("http://localhost:5000","/api/users"),{headers:{Authorization:"Bearer ".concat(b)}});case 2:n=e.sent,N(n.data),q({name:i,userId:t});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(U.jsxs)(v.a,{component:"main",alignItems:"center",children:[Object(U.jsx)(s.a,{}),Object(U.jsxs)(M.a,{component:"h1",variant:"h5",sx:{mt:1},children:["Welcome Back: ",i]}),Object(U.jsx)(T.a,{size:"large",sx:{mt:3,mb:2},onClick:V,variant:"contained",alignItems:"center",children:"Refresh"}),Object(U.jsx)(w.a,{component:S.a,children:Object(U.jsxs)(y.a,{sx:{minWidth:650},"aria-label":"simple table",children:[Object(U.jsx)(B.a,{children:Object(U.jsxs)(C.a,{children:[Object(U.jsx)(I.a,{children:"No"}),Object(U.jsx)(I.a,{children:"Name"}),Object(U.jsx)(I.a,{children:"Email"})]})}),Object(U.jsx)(k.a,{children:L.map((function(e,t){return Object(U.jsxs)(C.a,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[Object(U.jsx)(I.a,{children:t+1}),Object(U.jsx)(I.a,{children:e.name}),Object(U.jsx)(I.a,{children:e.email})]},e.id)}))})]})}),Object(U.jsx)(A,{name:i})]})},V=n(265),J=n(266),Y=function(){var e=Object(o.useContext)(ie).socket,t=Object(u.f)(),n=function(){var n=Object(m.a)(h.a.mark((function n(){return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,p.a.delete("".concat("http://localhost:5000","/api/logout"));case 3:t.push("/"),e.disconnect(),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.log(n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(){return n.apply(this,arguments)}}();return Object(U.jsx)(l.a.Fragment,{children:Object(U.jsx)(V.a,{position:"static",children:Object(U.jsx)(J.a,{variant:"dense",children:Object(U.jsx)(T.a,{variant:"outlined",sx:{marginLeft:"auto"},onClick:n,children:"Log Out"})})})})},H=n(250),K=n(135);var Q=function(e){var t="board-"+H.a();return Object(o.useLayoutEffect)((function(){Object(K.pgnView)(t,{pgn:"\n  1. d4 d5 2. Nc3 Nc6 3. Nxd5 Nxd4\n  ",timerTime:1,locale:"en",startPlay:1,showResult:!0,boardSize:"650",showFen:!0,pieceStyle:"merida",resizable:!0})})),Object(U.jsx)("div",{className:"pgnviewer",id:t})},X=n(14),Z=n(248),$=n(255),ee=n.p+"static/media/lightchess_logo_blue.a33aa897.png";function te(e){return Object(U.jsxs)(M.a,Object(X.a)(Object(X.a)({variant:"body2",color:"text.secondary",align:"center"},e),{},{children:["Copyright \xa9 ",Object(U.jsx)($.a,{color:"inherit",href:"https://github.com/l1ghtweight/",children:"Lightweight"})," ",(new Date).getFullYear(),"."]}))}var ne=function(){var e=Object(o.useState)(""),t=Object(r.a)(e,2),n=t[0],a=t[1],c=Object(o.useState)(""),i=Object(r.a)(c,2),l=i[0],j=i[1],d=Object(o.useState)(""),b=Object(r.a)(d,2),O=(b[0],b[1]),x=Object(u.f)(),f=function(){var e=Object(m.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,p.a.post("".concat("http://localhost:5000","/api/login"),{email:n,password:l});case 4:x.push("/dashboard"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),e.t0.response&&O(e.t0.response.data.msg);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(U.jsxs)(v.a,{component:"main",maxWidth:"xs",children:[Object(U.jsx)(s.a,{}),Object(U.jsxs)(_.a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(U.jsx)("img",{style:{width:150,height:150},src:ee,alt:"lightchess-logo"}),Object(U.jsx)(M.a,{component:"h1",variant:"h5",sx:{mt:1},children:"Sign in"}),Object(U.jsxs)(_.a,{component:"form",onSubmit:f,noValidate:!0,sx:{mt:1},children:[Object(U.jsx)(Z.a,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",onChange:function(e){return a(e.target.value)},autoFocus:!0}),Object(U.jsx)(Z.a,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",onChange:function(e){return j(e.target.value)},autoComplete:"current-password"}),Object(U.jsx)(T.a,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Sign In"}),Object(U.jsxs)(g.a,{container:!0,children:[Object(U.jsx)(g.a,{item:!0,xs:!0,children:Object(U.jsx)($.a,{href:"#",variant:"body2",children:"Forgot password?"})}),Object(U.jsx)(g.a,{item:!0,children:Object(U.jsx)($.a,{href:"register",variant:"body2",children:"Don't have an account? Sign Up"})})]})]}),Object(U.jsx)($.a,{href:"http://localhost:5000/api/login/federated/google",variant:"body2",sx:{mt:2},children:"Login with Google"})]}),Object(U.jsx)(te,{sx:{mt:8,mb:4}})]})};function ae(e){return Object(U.jsxs)(M.a,Object(X.a)(Object(X.a)({variant:"body2",color:"text.secondary",align:"center"},e),{},{children:["Copyright \xa9 ",Object(U.jsx)($.a,{color:"inherit",href:"https://github.com/l1ghtweight/",children:"Lightweight"})," ",(new Date).getFullYear(),"."]}))}var ce=function(){var e=Object(o.useState)(""),t=Object(r.a)(e,2),n=t[0],a=t[1],c=Object(o.useState)(""),i=Object(r.a)(c,2),l=i[0],j=i[1],d=Object(o.useState)(""),b=Object(r.a)(d,2),O=b[0],x=b[1],f=Object(o.useState)(""),w=Object(r.a)(f,2),S=w[0],y=w[1],k=Object(o.useState)(""),C=Object(r.a)(k,2),I=(C[0],C[1]),W=Object(u.f)(),D=function(){var e=Object(m.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,p.a.post("".concat("http://localhost:5000","/api/register"),{name:n,email:l,password:O,confPassword:S});case 4:W.push("/"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),e.t0.response&&I(e.t0.response.data.msg);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(U.jsxs)(v.a,{component:"main",maxWidth:"xs",children:[Object(U.jsx)(s.a,{}),Object(U.jsxs)(_.a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(U.jsx)("img",{style:{width:150,height:150},src:ee,alt:"lightchess-logo"}),Object(U.jsx)(M.a,{component:"h1",variant:"h5",sx:{mt:1},children:"Sign up"}),Object(U.jsxs)(_.a,{component:"form",noValidate:!0,onSubmit:D,sx:{mt:3},children:[Object(U.jsxs)(g.a,{container:!0,spacing:2,children:[Object(U.jsx)(g.a,{item:!0,xs:12,children:Object(U.jsx)(Z.a,{autoComplete:"given-name",name:"Name",required:!0,fullWidth:!0,id:"Name",label:"Name",autoFocus:!0,onChange:function(e){return a(e.target.value)}})}),Object(U.jsx)(g.a,{item:!0,xs:12,children:Object(U.jsx)(Z.a,{required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",onChange:function(e){return j(e.target.value)}})}),Object(U.jsx)(g.a,{item:!0,xs:12,children:Object(U.jsx)(Z.a,{required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"new-password",onChange:function(e){return x(e.target.value)}})}),Object(U.jsx)(g.a,{item:!0,xs:12,children:Object(U.jsx)(Z.a,{required:!0,fullWidth:!0,name:"confirm-password",label:"Confirm Password",type:"password",id:"confirm-password",autoComplete:"Confirm-password",onChange:function(e){return y(e.target.value)}})})]}),Object(U.jsx)(T.a,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Sign Up"}),Object(U.jsx)(g.a,{container:!0,justifyContent:"flex-end",children:Object(U.jsx)(g.a,{item:!0,children:Object(U.jsx)($.a,{href:"login",variant:"body2",children:"Already have an account? Sign in"})})})]})]}),Object(U.jsx)(ae,{sx:{mt:5}})]})},re=n(137),se=Object(re.a)({palette:{mode:"dark"}}),ie=l.a.createContext(),oe=Object(d.a)("ws://localhost:5000",{autoConnect:!1}),le=function(e){var t=e.name,n=e.userId;!0!==oe.connected&&""!==t&&(oe.connect(),oe.emit("initSocket",{name:t,userId:n},(function(e){console.log(e)})))};var je=function(){var e=Object(o.useState)(new Map),t=Object(r.a)(e,2),n=t[0],a=t[1],c=Object(o.useState)([]),l=Object(r.a)(c,2),d=l[0],b=l[1],h=Object(o.useState)(-1),m=Object(r.a)(h,2),O=m[0],p=m[1];return Object(U.jsx)(ie.Provider,{value:{userMap:n,userList:d,updateUserList:function(){oe.emit("getusers","args",(function(e){var t=new Map(Object.entries(e)),n=[];t.forEach((function(e,t){n.push({id:t,name:e.name,userId:e.userId})})),a(t),b([].concat(n))}))},socket:oe,initSocket:le,userId:O,setUserId:p},children:Object(U.jsxs)(i.a,{theme:se,children:[Object(U.jsx)(s.a,{}),Object(U.jsx)(j.a,{children:Object(U.jsxs)(u.c,{children:[Object(U.jsx)(u.a,{exact:!0,path:"/",children:Object(U.jsx)(ne,{})}),Object(U.jsx)(u.a,{exact:!0,path:"/login",children:Object(U.jsx)(ne,{})}),Object(U.jsx)(u.a,{path:"/register",children:Object(U.jsx)(ce,{})}),Object(U.jsxs)(u.a,{path:"/dashboard",children:[Object(U.jsx)(Y,{}),Object(U.jsx)(G,{})]}),Object(U.jsxs)(u.a,{path:"/pgnviewer",children:[Object(U.jsx)(Y,{}),Object(U.jsx)(Q,{})]}),Object(U.jsxs)(u.a,{path:"/play/:id/:mycolor",children:[Object(U.jsx)(Y,{}),Object(U.jsx)(q,{})]}),Object(U.jsxs)(u.a,{path:"/play",children:[Object(U.jsx)(Y,{}),Object(U.jsx)(q,{})]})]})})]})})};p.a.defaults.withCredentials=!0;var ue=document.getElementById("root");c.a.render(Object(U.jsx)(je,{}),ue)}},[[200,1,2]]]);
//# sourceMappingURL=main.2dab311d.chunk.js.map